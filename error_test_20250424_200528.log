2025-04-24 20:05:28,456 - error_test - INFO - 成功导入通信模块
2025-04-24 20:05:28,458 - error_test - INFO - 成功导入PLC模拟器
2025-04-24 20:05:28,458 - error_test - INFO - ====== 开始测试通信模块错误处理 ======
2025-04-24 20:05:28,458 - error_test - INFO - === 测试连接错误处理 ===
2025-04-24 20:05:28,458 - error_test - INFO - 测试不存在的端口...
2025-04-24 20:05:28,458 - modbus_client - INFO - 尝试连接到串口 NONEXISTENT，波特率 9600
2025-04-24 20:05:28,459 - pymodbus.client.sync - ERROR - could not open port 'NONEXISTENT': FileNotFoundError(2, '系统找不到指定的文件。', None, 2)
2025-04-24 20:05:28,459 - modbus_client - ERROR - 无法连接到PLC，端口: NONEXISTENT
2025-04-24 20:05:28,459 - error_test - INFO - 不存在端口测试通过
2025-04-24 20:05:28,489 - error_test - INFO - 测试错误的通信参数...
2025-04-24 20:05:28,489 - modbus_client - INFO - 尝试连接到串口 COM1，波特率 115200
2025-04-24 20:05:28,489 - modbus_client - ERROR - 连接PLC时发生错误: Not a valid parity: 'Z'
2025-04-24 20:05:28,495 - error_test - INFO - 错误通信参数测试完成
2025-04-24 20:05:28,496 - error_test - INFO - 测试连接超时...
2025-04-24 20:05:28,496 - modbus_client - INFO - 尝试连接到串口 COM1，波特率 9600
2025-04-24 20:05:28,496 - modbus_client - INFO - 已连接到PLC，端口: COM1
2025-04-24 20:05:28,496 - error_test - INFO - 连接耗时：0.000秒
2025-04-24 20:05:28,496 - error_test - INFO - 连接超时测试完成
2025-04-24 20:05:28,496 - error_test - INFO - 所有连接错误处理测试完成
2025-04-24 20:05:28,496 - error_test - INFO - === 测试重试机制 ===
2025-04-24 20:05:28,497 - modbus_client - INFO - 已更新重试策略: 次数=3, 延迟=0.2秒, 渐进式=False
2025-04-24 20:05:28,497 - modbus_client - INFO - 尝试连接到串口 COM1，波特率 9600
2025-04-24 20:05:28,497 - pymodbus.client.sync - ERROR - could not open port 'COM1': PermissionError(13, '拒绝访问。', None, 5)
2025-04-24 20:05:28,497 - modbus_client - ERROR - 无法连接到PLC，端口: COM1
2025-04-24 20:05:28,497 - error_test - WARNING - 连接失败，无法测试重试机制
2025-04-24 20:05:28,497 - error_test - INFO - === 测试自动重连功能 ===
2025-04-24 20:05:28,498 - modbus_client - INFO - 尝试连接到串口 COM1，波特率 9600
2025-04-24 20:05:28,498 - pymodbus.client.sync - ERROR - could not open port 'COM1': PermissionError(13, '拒绝访问。', None, 5)
2025-04-24 20:05:28,498 - modbus_client - ERROR - 无法连接到PLC，端口: COM1
2025-04-24 20:05:28,498 - error_test - WARNING - 连接失败，无法测试自动重连
2025-04-24 20:05:28,498 - error_test - INFO - === 测试健康检查功能 ===
2025-04-24 20:05:28,499 - error_test - ERROR - 测试过程中发生未捕获异常: ModbusRTUClient.__init__() got an unexpected keyword argument 'unit'
2025-04-24 20:05:28,500 - error_test - ERROR - Traceback (most recent call last):
  File "D:\new\test_error_handling.py", line 397, in main
    test_health_check()
    ~~~~~~~~~~~~~~~~~^^
  File "D:\new\test_error_handling.py", line 160, in test_health_check
    communicator = PLCCommunicator(
        port_or_client=TEST_PORT,
        timeout=0.5
    )
  File "D:\new\weighing_system\src\communication\plc_communicator.py", line 84, in __init__
    self.client = ModbusRTUClient(
                  ~~~~~~~~~~~~~~~^
        port=port_or_client,
        ^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
        retry_delay=retry_delay
        ^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: ModbusRTUClient.__init__() got an unexpected keyword argument 'unit'

