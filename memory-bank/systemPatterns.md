# 系统模式

## 系统架构

系统采用模块化分层架构，分为以下主要模块：

1. **通信模块**：负责通过MODBUS RTU协议与PLC进行通信，包含：
   - ModbusRTUClient：底层MODBUS通信客户端
   - AddressMapper：地址映射器
   - DataConverter：数据类型转换工具
   - PLCCommunicator：PLC通信管理器
   - ErrorHandler：错误处理器

2. **数据采集模块**：负责监测系统状态、检测包装周期并采集数据
   - CycleDetector：周期检测器
   - DataRecorder：数据记录器
   - StatusMonitor：状态监视器

3. **自适应算法模块**：实现自适应控制算法
   - AdaptiveController：自适应控制器
   - ThreeStageController：三阶段控制器
   - PIDController：PID控制器
   - PerformanceEvaluator：性能评估器

4. **控制模块**：系统的中央控制点
   - SystemController：系统控制器
   - HopperController：料斗控制器
   - ParameterManager：参数管理器

5. **用户界面模块**：提供用户交互界面
   - MainWindow：主窗口
   - ConnectionConfigDialog：连接配置对话框
   - RealTimeMonitor：实时监控界面
   - ParameterEditor：参数编辑器
   - DataVisualizer：数据可视化器

## 关键技术决策

1. **使用Python作为开发语言**：Python具有丰富的库支持、快速开发能力和良好的跨平台特性，适合实现本系统。

2. **采用MODBUS RTU协议**：选择MODBUS RTU协议作为与PLC通信的标准，该协议被广泛支持且实现简单。

3. **模块化设计**：采用高度模块化设计，各功能模块独立封装，便于维护和扩展。

4. **三阶段控制策略**：采用快加、慢加、点动三阶段控制策略，平衡包装速度与精度。

5. **错误处理机制**：实现完善的错误处理和重试机制，确保系统在通信异常时的稳定性。

## 设计模式

1. **工厂模式**：用于创建不同类型的控制器和通信客户端
2. **观察者模式**：用于数据变化通知和UI更新
3. **策略模式**：用于实现不同的控制算法策略
4. **单例模式**：用于系统控制器和通信管理器
5. **命令模式**：用于实现控制命令的封装和执行
6. **装饰器模式**：用于数据处理和转换的扩展

## 组件关系

系统组件之间遵循以下关系和交互方式：

1. **通信层与控制层**：控制层通过PLCCommunicator接口调用通信层功能，通信层不感知控制层逻辑

2. **控制层与算法层**：控制层将包装数据传递给算法层，算法层计算最优参数返回给控制层

3. **控制层与数据采集层**：控制层接收数据采集层的周期事件和状态信息，据此执行控制逻辑

4. **控制层与界面层**：界面层通过事件和信号机制与控制层交互，同时直接调用控制层API执行命令

5. **数据流向**：
   - PLC → 通信模块 → 数据采集模块 → 控制模块 → 自适应算法模块 → 控制模块 → 通信模块 → PLC
   - 控制模块 ↔ 用户界面模块 